# MCAPIBridge éŸ³é¢‘ç³»ç»Ÿå®Œæ•´æ–‡æ¡£

#### [English](https://github.com/TaotianZhufang/MCAPIBridge/blob/main/Bridges/Python/PyAudio.MD)|ç®€ä½“ä¸­æ–‡

## ğŸ“š AudioManager ç±»

æ‰€æœ‰éŸ³é¢‘åŠŸèƒ½é€šè¿‡ `mc.audio` è®¿é—®ã€‚

```python
from mc import Minecraft

mc = Minecraft()
# é€šè¿‡ mc.audio è®¿é—®éŸ³é¢‘åŠŸèƒ½
```

---

## ğŸµ éŸ³é¢‘åŠ è½½å‡½æ•°

### `generate_tone(target, audio_id, frequency, duration, sample_rate)`

**åŠŸèƒ½**ï¼šç”Ÿæˆæ­£å¼¦æ³¢éŸ³è°ƒ

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| target | str | ç©å®¶åï¼Œ`""` ç¬¬ä¸€ä¸ªç©å®¶ï¼Œ`"@a"` æ‰€æœ‰ç©å®¶ | å¿…å¡« |
| audio_id | str | éŸ³é¢‘å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè‡ªå®šä¹‰å‘½åï¼‰ | å¿…å¡« |
| frequency | float | é¢‘ç‡ (Hz) | 440 |
| duration | float | æŒç»­æ—¶é—´ (ç§’) | 1.0 |
| sample_rate | int | é‡‡æ ·ç‡ | 44100 |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# ç”Ÿæˆ A4 éŸ³è°ƒ (440Hz)ï¼ŒæŒç»­ 2 ç§’
mc.audio.generate_tone(player, "beep", 440, 2.0)

# ç”Ÿæˆé«˜éŸ³ C (523Hz)ï¼ŒæŒç»­ 1 ç§’
mc.audio.generate_tone(player, "high_c", 523, 1.0)

# å¯¹æ‰€æœ‰ç©å®¶ç”ŸæˆéŸ³è°ƒ
mc.audio.generate_tone("@a", "alarm", 880, 3.0)

# å¯¹ç¬¬ä¸€ä¸ªç©å®¶ç”Ÿæˆ
mc.audio.generate_tone("", "tone", 440, 1.0)
```

**å¸¸ç”¨é¢‘ç‡å‚è€ƒ**ï¼š
| éŸ³ç¬¦ | é¢‘ç‡ (Hz) |
|------|-----------|
| C4 (ä¸­å¤®C) | 262 |
| D4 | 294 |
| E4 | 330 |
| F4 | 349 |
| G4 | 392 |
| A4 | 440 |
| B4 | 494 |
| C5 | 523 |
| A5 | 880 |

---

### `load_wav(target, audio_id, filepath)`

**åŠŸèƒ½**ï¼šåŠ è½½ WAV éŸ³é¢‘æ–‡ä»¶

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| target | str | ç©å®¶å |
| audio_id | str | éŸ³é¢‘å”¯ä¸€æ ‡è¯†ç¬¦ |
| filepath | str | WAV æ–‡ä»¶è·¯å¾„ |

**æ”¯æŒæ ¼å¼**ï¼š
- 8ä½ æˆ– 16ä½ PCM
- å•å£°é“ æˆ– ç«‹ä½“å£°ï¼ˆè‡ªåŠ¨è½¬å•å£°é“ï¼‰
- ä»»æ„é‡‡æ ·ç‡

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# åŠ è½½éŸ³ä¹æ–‡ä»¶
mc.audio.load_wav(player, "bgm", "music/background.wav")

# åŠ è½½éŸ³æ•ˆ
mc.audio.load_wav(player, "explosion", "sounds/boom.wav")

# åŠ è½½åˆ°æ‰€æœ‰ç©å®¶
mc.audio.load_wav("@a", "victory", "sounds/win.wav")
```

**æ³¨æ„**ï¼š
- å¤§æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ†å—ä¼ è¾“
- åŠ è½½åéœ€è¦ç­‰å¾…ä¸€ä¼šå†æ’­æ”¾ï¼ˆå»ºè®® `time.sleep(1.0)`ï¼‰

---

### `load_raw(target, audio_id, pcm_data, sample_rate)`

**åŠŸèƒ½**ï¼šåŠ è½½åŸå§‹ PCM éŸ³é¢‘æ•°æ®

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| target | str | ç©å®¶å | å¿…å¡« |
| audio_id | str | éŸ³é¢‘å”¯ä¸€æ ‡è¯†ç¬¦ | å¿…å¡« |
| pcm_data | bytes | 16ä½æœ‰ç¬¦å·æ•´æ•° PCM æ•°æ® | å¿…å¡« |
| sample_rate | int | é‡‡æ ·ç‡ | 44100 |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import struct
import math

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# æ‰‹åŠ¨ç”ŸæˆéŸ³é¢‘æ•°æ®
sample_rate = 44100
duration = 2.0
frequency = 440

samples = []
for i in range(int(sample_rate * duration)):
    t = i / sample_rate
    value = int(32767 * math.sin(2 * math.pi * frequency * t))
    samples.append(value)

pcm_data = struct.pack(f'<{len(samples)}h', *samples)
mc.audio.load_raw(player, "custom", pcm_data, sample_rate)
```

---

## â–¶ï¸ æ’­æ”¾æ§åˆ¶å‡½æ•°

### `play(target, audio_id, volume, loop)`

**åŠŸèƒ½**ï¼šæ™®é€šæ’­æ”¾ï¼ˆæ—  3D æ•ˆæœï¼‰

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| target | str | ç©å®¶å | å¿…å¡« |
| audio_id | str | å·²åŠ è½½çš„éŸ³é¢‘ ID | å¿…å¡« |
| volume | float | éŸ³é‡ (0.0 - 1.0) | 1.0 |
| loop | bool | æ˜¯å¦å¾ªç¯ | False |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# åŠ è½½éŸ³é¢‘
mc.audio.generate_tone(player, "beep", 440, 2.0)
time.sleep(1.0)

# æ™®é€šæ’­æ”¾
mc.audio.play(player, "beep")

# è®¾ç½®éŸ³é‡
mc.audio.play(player, "beep", volume=0.5)

# å¾ªç¯æ’­æ”¾
mc.audio.play(player, "beep", volume=0.8, loop=True)

# 3ç§’ååœæ­¢
time.sleep(3)
mc.audio.stop(player, "beep")
```

---

### `play_3d(target, audio_id, x, y, z, volume, rolloff)`

**åŠŸèƒ½**ï¼š3D ç©ºé—´éŸ³æ•ˆæ’­æ”¾

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| target | str | ç©å®¶å | å¿…å¡« |
| audio_id | str | å·²åŠ è½½çš„éŸ³é¢‘ ID | å¿…å¡« |
| x, y, z | float | éŸ³æºåœ¨ä¸–ç•Œä¸­çš„åæ ‡ | å¿…å¡« |
| volume | float | éŸ³é‡ (0.0 - 1.0) | 1.0 |
| rolloff | float | è·ç¦»è¡°å‡ç³»æ•° | 1.0 |

**rolloff å‚æ•°è¯´æ˜**ï¼š
| å€¼ | æ•ˆæœ |
|-----|------|
| 0.5 | æ…¢è¡°å‡ï¼Œè¿œå¤„ä¹Ÿèƒ½å¬æ¸… |
| 1.0 | æ­£å¸¸è¡°å‡ |
| 2.0 | å¿«è¡°å‡ï¼Œåªæœ‰è¿‘å¤„èƒ½å¬åˆ° |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# è·å–ç©å®¶ä½ç½®
pos = mc.getPlayerPos(player)

# åœ¨ç©å®¶å‰æ–¹ 10 æ ¼æ’­æ”¾
mc.audio.generate_tone(player, "front", 500, 5.0)
time.sleep(1.0)

front = pos.forward(10)
mc.audio.play_3d(player, "front", front.x, front.y, front.z, 1.0, 1.0)

# åœ¨å›ºå®šåæ ‡æ’­æ”¾
mc.audio.play_3d(player, "sound", 100, 64, 200, 0.8, 0.5)

# æ…¢è¡°å‡ï¼ˆè¿œå¤„ä¹Ÿèƒ½å¬åˆ°ï¼‰
mc.audio.play_3d(player, "ambient", x, y, z, 1.0, 0.3)

# å¿«è¡°å‡ï¼ˆåªæœ‰è¿‘å¤„èƒ½å¬åˆ°ï¼‰
mc.audio.play_3d(player, "whisper", x, y, z, 1.0, 2.0)
```

---

### `pause(target, audio_id)`

**åŠŸèƒ½**ï¼šæš‚åœæ’­æ”¾

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| target | str | ç©å®¶å |
| audio_id | str | éŸ³é¢‘ ID |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

mc.audio.play(player, "music", loop=True)
time.sleep(5)

# æš‚åœ
mc.audio.pause(player, "music")
time.sleep(2)

# ç»§ç»­æ’­æ”¾
mc.audio.play(player, "music")
```

---

### `stop(target, audio_id)`

**åŠŸèƒ½**ï¼šåœæ­¢æ’­æ”¾

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| target | str | ç©å®¶å |
| audio_id | str | éŸ³é¢‘ ID |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

mc.audio.play(player, "music", loop=True)
time.sleep(10)

# åœæ­¢
mc.audio.stop(player, "music")
```

---

## ğŸ›ï¸ éŸ³é¢‘å±æ€§å‡½æ•°

### `set_volume(target, audio_id, volume)`

**åŠŸèƒ½**ï¼šåŠ¨æ€è°ƒæ•´éŸ³é‡

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| target | str | ç©å®¶å |
| audio_id | str | éŸ³é¢‘ ID |
| volume | float | éŸ³é‡ (0.0 - 1.0) |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

mc.audio.play(player, "music")

# éŸ³é‡æ¸å˜
for v in [1.0, 0.8, 0.6, 0.4, 0.2, 0.0]:
    mc.audio.set_volume(player, "music", v)
    time.sleep(0.5)
```

---

### `set_position(target, audio_id, x, y, z)` (éœ€é€šè¿‡ _send è°ƒç”¨)

**åŠŸèƒ½**ï¼šæ›´æ–° 3D éŸ³æºä½ç½®ï¼ˆç”¨äºç§»åŠ¨çš„éŸ³æºï¼‰

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft
import math

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]
pos = mc.getPlayerPos(player)

# æ’­æ”¾ 3D éŸ³æ•ˆ
mc.audio.play_3d(player, "moving", pos.x + 10, pos.y, pos.z, 1.0, 0.5)

# è®©éŸ³æºç»•ç©å®¶è½¬åœˆ
for i in range(60):
    angle = i * 0.1
    x = pos.x + 10 * math.cos(angle)
    z = pos.z + 10 * math.sin(angle)
    mc._send(f"audio.position({player},moving,{x},{pos.y},{z})")
    time.sleep(0.1)
```

---

### `unload(target, audio_id)`

**åŠŸèƒ½**ï¼šå¸è½½éŸ³é¢‘ï¼Œé‡Šæ”¾å†…å­˜

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| target | str | ç©å®¶å |
| audio_id | str | éŸ³é¢‘ ID |

**ç¤ºä¾‹**ï¼š
```python
from mc import Minecraft

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# ä½¿ç”¨å®Œæ¯•åå¸è½½
mc.audio.stop(player, "music")
mc.audio.unload(player, "music")

# æ‰¹é‡å¸è½½
audio_ids = ["sound1", "sound2", "sound3"]
for aid in audio_ids:
    mc.audio.unload(player, aid)
```

---

## ğŸ“– å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç®€å•éŸ³æ•ˆ

```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# ç”Ÿæˆå¹¶æ’­æ”¾
mc.audio.generate_tone(player, "beep", 440, 2.0)
time.sleep(1.0)
mc.audio.play(player, "beep")
time.sleep(2.5)
mc.audio.unload(player, "beep")
```

---

### ç¤ºä¾‹ 2ï¼šèƒŒæ™¯éŸ³ä¹

```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# åŠ è½½ WAV æ–‡ä»¶
mc.audio.load_wav(player, "bgm", "music.wav")
time.sleep(2.0)

# å¾ªç¯æ’­æ”¾
mc.audio.play(player, "bgm", volume=0.6, loop=True)

# æ’­æ”¾ 30 ç§’
time.sleep(30)

# æ¸å¼±ç»“æŸ
for v in [0.5, 0.4, 0.3, 0.2, 0.1, 0.0]:
    mc.audio.set_volume(player, "bgm", v)
    time.sleep(0.3)

mc.audio.stop(player, "bgm")
mc.audio.unload(player, "bgm")
```

---

### ç¤ºä¾‹ 3ï¼š3D éŸ³æ•ˆ

```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]
pos = mc.getPlayerPos(player)

# ç”ŸæˆéŸ³æ•ˆ
mc.audio.generate_tone(player, "alert", 600, 3.0)
time.sleep(1.0)

# åœ¨ç©å®¶å‰æ–¹ 10 æ ¼æ’­æ”¾
front = pos.forward(10)
mc.audio.play_3d(player, "alert", front.x, front.y, front.z, 1.0, 1.0)

mc.postToChat("è½¬åŠ¨è§†è§’æ„Ÿå— 3D éŸ³æ•ˆ!")
time.sleep(4)

mc.audio.unload(player, "alert")
```

---

### ç¤ºä¾‹ 4ï¼šç¯ç»•éŸ³æ•ˆ

```python
from mc import Minecraft
import time
import math

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]
pos = mc.getPlayerPos(player)

# ç”Ÿæˆé•¿éŸ³é¢‘
mc.audio.generate_tone(player, "surround", 500, 15.0)
time.sleep(1.5)

# å¼€å§‹æ’­æ”¾
mc.audio.play_3d(player, "surround", pos.x + 10, pos.y, pos.z, 1.0, 0.3)

mc.postToChat("å£°éŸ³ç»•ç€ä½ è½¬åœˆ!")

# ç»•åœˆ
radius = 10
for i in range(80):
    angle = i * 0.12
    x = pos.x + radius * math.cos(angle)
    z = pos.z + radius * math.sin(angle)
    mc._send(f"audio.position({player},surround,{x},{pos.y},{z})")
    time.sleep(0.1)

mc.audio.stop(player, "surround")
mc.audio.unload(player, "surround")
```

---

### ç¤ºä¾‹ 5ï¼šå¤šéŸ³æºå’Œå¼¦

```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]

# C å¤§è°ƒå’Œå¼¦: C E G
mc.audio.generate_tone(player, "c", 262, 3.0)
mc.audio.generate_tone(player, "e", 330, 3.0)
mc.audio.generate_tone(player, "g", 392, 3.0)
time.sleep(1.5)

mc.postToChat("C å¤§è°ƒå’Œå¼¦!")

# åŒæ—¶æ’­æ”¾
mc.audio.play(player, "c", volume=0.6)
mc.audio.play(player, "e", volume=0.6)
mc.audio.play(player, "g", volume=0.6)

time.sleep(4)

# æ¸…ç†
for note in ["c", "e", "g"]:
    mc.audio.unload(player, note)
```

---

### ç¤ºä¾‹ 6ï¼šè·ç¦»è¡°å‡æ•ˆæœ

```python
from mc import Minecraft
import time

mc = Minecraft()
player = mc.getOnlinePlayers()[0]["name"]
pos = mc.getPlayerPos(player)

mc.audio.generate_tone(player, "approach", 440, 10.0)
time.sleep(1.0)

# ä»è¿œå¤„å¼€å§‹
start_dist = 50
end_dist = 3

mc.audio.play_3d(player, "approach", pos.x, pos.y, pos.z + start_dist, 1.0, 1.0)

mc.postToChat("å£°éŸ³é è¿‘ä¸­...")

# é è¿‘
for i in range(30):
    dist = start_dist - (start_dist - end_dist) * (i / 30)
    mc._send(f"audio.position({player},approach,{pos.x},{pos.y},{pos.z + dist})")
    time.sleep(0.1)

mc.postToChat("æœ€è¿‘ç‚¹!")
time.sleep(1)

mc.postToChat("å£°éŸ³è¿œå»ä¸­...")

# è¿œå»
for i in range(30):
    dist = end_dist + (start_dist - end_dist) * (i / 30)
    mc._send(f"audio.position({player},approach,{pos.x},{pos.y},{pos.z + dist})")
    time.sleep(0.1)

mc.audio.stop(player, "approach")
mc.audio.unload(player, "approach")
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åŠ è½½ç­‰å¾…**ï¼šéŸ³é¢‘åŠ è½½éœ€è¦æ—¶é—´ï¼Œå¤§æ–‡ä»¶éœ€è¦æ›´é•¿ç­‰å¾…
   ```python
   mc.audio.generate_tone(player, "tone", 440, 5.0)
   time.sleep(1.0)  # ç­‰å¾…åŠ è½½
   mc.audio.play(player, "tone")
   ```

2. **èµ„æºé‡Šæ”¾**ï¼šç”¨å®Œåè®°å¾— `unload`
   ```python
   mc.audio.stop(player, "sound")
   mc.audio.unload(player, "sound")
   ```

3. **éŸ³é¢‘ ID å”¯ä¸€**ï¼šåŒä¸€ä¸ª ID ä¼šè¦†ç›–ä¹‹å‰çš„éŸ³é¢‘

4. **WAV æ ¼å¼**ï¼šåªæ”¯æŒ PCM æ ¼å¼ï¼Œä¸æ”¯æŒå‹ç¼©çš„ WAV

5. **target å‚æ•°**ï¼š
   - `"PlayerName"` - æŒ‡å®šç©å®¶
   - `""` - ç¬¬ä¸€ä¸ªç©å®¶
   - `"@a"` - æ‰€æœ‰ç©å®¶